/**
 *   ChilliLibrary-min.js
 *   V2.0
 */
function getel(e){if(document.getElementById){return document.getElementById(e)}else if(document.all){return document.all[e]}}function log(e,t){if(!chilliController.debug)return;if(typeof trace=="function"){trace(e)}else if(typeof console=="object"){console.debug(e)}if(getel("debugarea")){var n=getel("debugarea");n.value=n.value+"\n"+e;n.scrollTop=n.scrollHeight-n.clientHeight}}function dumpObject(e){var t="";for(var n in e){t=t+"    "+n+" = "+e[n]+"\n";if(typeof e[n]=="object"){for(var r in e[n]){t=t+"      "+r+" = "+e[n][r]+"\n"}}}return t}function ChilliMD5(){function r(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var n=1732584193;var r=-271733879;var i=-1732584194;var s=271733878;for(var c=0;c<e.length;c+=16){var h=n;var p=r;var d=i;var v=s;n=o(n,r,i,s,e[c+0],7,-680876936);s=o(s,n,r,i,e[c+1],12,-389564586);i=o(i,s,n,r,e[c+2],17,606105819);r=o(r,i,s,n,e[c+3],22,-1044525330);n=o(n,r,i,s,e[c+4],7,-176418897);s=o(s,n,r,i,e[c+5],12,1200080426);i=o(i,s,n,r,e[c+6],17,-1473231341);r=o(r,i,s,n,e[c+7],22,-45705983);n=o(n,r,i,s,e[c+8],7,1770035416);s=o(s,n,r,i,e[c+9],12,-1958414417);i=o(i,s,n,r,e[c+10],17,-42063);r=o(r,i,s,n,e[c+11],22,-1990404162);n=o(n,r,i,s,e[c+12],7,1804603682);s=o(s,n,r,i,e[c+13],12,-40341101);i=o(i,s,n,r,e[c+14],17,-1502002290);r=o(r,i,s,n,e[c+15],22,1236535329);n=u(n,r,i,s,e[c+1],5,-165796510);s=u(s,n,r,i,e[c+6],9,-1069501632);i=u(i,s,n,r,e[c+11],14,643717713);r=u(r,i,s,n,e[c+0],20,-373897302);n=u(n,r,i,s,e[c+5],5,-701558691);s=u(s,n,r,i,e[c+10],9,38016083);i=u(i,s,n,r,e[c+15],14,-660478335);r=u(r,i,s,n,e[c+4],20,-405537848);n=u(n,r,i,s,e[c+9],5,568446438);s=u(s,n,r,i,e[c+14],9,-1019803690);i=u(i,s,n,r,e[c+3],14,-187363961);r=u(r,i,s,n,e[c+8],20,1163531501);n=u(n,r,i,s,e[c+13],5,-1444681467);s=u(s,n,r,i,e[c+2],9,-51403784);i=u(i,s,n,r,e[c+7],14,1735328473);r=u(r,i,s,n,e[c+12],20,-1926607734);n=a(n,r,i,s,e[c+5],4,-378558);s=a(s,n,r,i,e[c+8],11,-2022574463);i=a(i,s,n,r,e[c+11],16,1839030562);r=a(r,i,s,n,e[c+14],23,-35309556);n=a(n,r,i,s,e[c+1],4,-1530992060);s=a(s,n,r,i,e[c+4],11,1272893353);i=a(i,s,n,r,e[c+7],16,-155497632);r=a(r,i,s,n,e[c+10],23,-1094730640);n=a(n,r,i,s,e[c+13],4,681279174);s=a(s,n,r,i,e[c+0],11,-358537222);i=a(i,s,n,r,e[c+3],16,-722521979);r=a(r,i,s,n,e[c+6],23,76029189);n=a(n,r,i,s,e[c+9],4,-640364487);s=a(s,n,r,i,e[c+12],11,-421815835);i=a(i,s,n,r,e[c+15],16,530742520);r=a(r,i,s,n,e[c+2],23,-995338651);n=f(n,r,i,s,e[c+0],6,-198630844);s=f(s,n,r,i,e[c+7],10,1126891415);i=f(i,s,n,r,e[c+14],15,-1416354905);r=f(r,i,s,n,e[c+5],21,-57434055);n=f(n,r,i,s,e[c+12],6,1700485571);s=f(s,n,r,i,e[c+3],10,-1894986606);i=f(i,s,n,r,e[c+10],15,-1051523);r=f(r,i,s,n,e[c+1],21,-2054922799);n=f(n,r,i,s,e[c+8],6,1873313359);s=f(s,n,r,i,e[c+15],10,-30611744);i=f(i,s,n,r,e[c+6],15,-1560198380);r=f(r,i,s,n,e[c+13],21,1309151649);n=f(n,r,i,s,e[c+4],6,-145523070);s=f(s,n,r,i,e[c+11],10,-1120210379);i=f(i,s,n,r,e[c+2],15,718787259);r=f(r,i,s,n,e[c+9],21,-343485551);n=l(n,h);r=l(r,p);i=l(i,d);s=l(s,v)}return[n,r,i,s]}function s(e,t,n,r,i,s){return l(c(l(l(t,e),l(r,s)),i),n)}function o(e,t,n,r,i,o,u){return s(t&n|~t&r,e,t,i,o,u)}function u(e,t,n,r,i,o,u){return s(t&r|n&~r,e,t,i,o,u)}function a(e,t,n,r,i,o,u){return s(t^n^r,e,t,i,o,u)}function f(e,t,n,r,i,o,u){return s(n^(t|~r),e,t,i,o,u)}function l(e,t){var n=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function c(e,t){return e<<t|e>>>32-t}function h(e){var t=[];var r=(1<<n)-1;for(var i=0;i<e.length*n;i+=n){t[i>>5]|=(e.charCodeAt(i/n)&r)<<i%32}return t}function p(t){var n=e?"0123456789ABCDEF":"0123456789abcdef";var r="";for(var i=0;i<t.length*4;i++){r+=n.charAt(t[i>>2]>>i%4*8+4&15)+n.charAt(t[i>>2]>>i%4*8&15)}return r}function d(t){var n=e?"0123456789ABCDEF":"0123456789abcdef";var r="";var i;for(var s=0;s<t.length;s++){i=t.charCodeAt(s);r=r+n.charAt(i/16);r=r+n.charAt(i%16)}return r}function v(e){e=e.toLowerCase();e=e.replace(/ /g,"");var t=[];for(i=0;i<e.length*4;i=i+8){octet=parseInt(e.substr(i/4,2),16);t[i>>5]|=(octet&255)<<i%32}return t}var e=0;var t="";var n=8;this.hex_md5=function(e){return p(r(h(e),e.length*n))};this.chap=function(e,t,n){var i=d(t);var s=e+i+n;var o=v(s);var u=r(o,s.length*4);return p(u)}}var chilliLibrary={revision:"85",apiVersion:"2.0"};if(!chilliController||!chilliController.host)var chilliController={interval:30,host:"1.0.0.1",port:false,ident:"00",ssl:false,uamService:false};chilliController.stateCodes={UNKNOWN:-1,NOT_AUTH:0,AUTH:1,AUTH_PENDING:2,AUTH_SPLASH:3};chilliController.session={};chilliController.accounting={};chilliController.redir={};chilliController.location={name:""};chilliController.challenge="";chilliController.message="";chilliController.clientState=chilliController.stateCodes.UNKNOWN;chilliController.command="";chilliController.autorefreshTimer=0;chilliController.urlRoot=function(){var e=chilliController.ssl?"https":"http";var t=e+"://"+chilliController.host+(chilliController.port?":"+chilliController.port.toString():"")+"/json/";return t};chilliController.onUpdate=function(e){log(">> Default onUpdate handler. <<\n>> You should write your own. <<\n>> cmd = "+e+" <<")};chilliController.onError=function(e){log(">> Default Error Handler<<\n>> You should write your own  <<\n>> "+e+" <<")};chilliController.formatTime=function(e,t){if(typeof e=="undefined"){return"Not available"}e=parseInt(e,10);if(typeof t!="undefined"&&e===0){return t}var n=Math.floor(e/3600);var r=Math.floor((e-3600*n)/60);var i=e%60;var s=i.toString();if(i<10){s="0"+s}var o=r.toString();if(r<10){o="0"+o}var u=n.toString();if(n<10){u="0"+u}if(e<60){return s+"s"}else if(e<3600){return o+"m"+s+"s"}else{return u+"h"+o+"m"+s+"s"}};chilliController.formatBytes=function(e,t){if(typeof e=="undefined"){e=0}else{e=parseInt(e,10)}if(typeof t!="undefined"&&e===0){return t}var n=Math.round(e/10)/100;if(n<1)return e+" Bytes";var r=Math.round(n/10)/100;if(r<1)return n+" Kilobytes";var i=Math.round(r/10)/100;if(i<1)return r+" Megabytes";return i+" Gigabytes"};chilliController.logon=function(e,t){if(typeof e!=="string"){chilliController.onError(1,"username missing (or incorrect type)")}if(typeof t!=="string"){chilliController.onError(2,"password missing (or incorrect type)")}log('chilliController.logon( "'+e+'" , "'+t+' " )');chilliController.temp={username:e,password:t};chilliController.command="logon";log("chilliController.logon: asking for a new challenge ");chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.logonStep2;chilliController.clientState=chilliController.AUTH_PENDING;chilliJSON.get(chilliController.urlRoot()+"status")};chilliController.logon2=function(e,t){if(typeof e!=="string"){chilliController.onError(1,"username missing (or incorrect type)")}if(typeof t!=="string"){chilliController.onError(2,"response missing (or incorrect type)")}log('chilliController.logon2( "'+e+'" , "'+t+' " )');chilliController.temp={username:e,response:t};chilliController.command="logon2";log("chilliController.logon2: asking for a new challenge ");chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.logonStep2;chilliController.clientState=chilliController.AUTH_PENDING;chilliJSON.get(chilliController.urlRoot()+"status")};chilliController.logonStep2=function(e){log("Entering logonStep 2");if(typeof e.challenge!="string"){log("logonStep2: cannot find a challenge. Aborting.");return chilliController.onError("Cannot get challenge")}if(e.clientSate===chilliController.stateCodes.AUTH){log("logonStep2: Already connected. Aborting.");return chilliController.onError("Already connected.")}var t=e.challenge;var n=chilliController.temp.username;var r=chilliController.temp.password;var i=chilliController.temp.response;log("chilliController.logonStep2: Got challenge = "+t);if(chilliController.uamService){log("chilliController.logonStep2: Logon using uamService (external MD5 CHAP)");var s;if(chilliController.uamService.indexOf("?")===-1){s="?"}else{s="&"}var o=chilliController.uamService+s+"username="+escape(n)+"&password="+escape(r)+"&challenge="+t;if(chilliController.queryObj&&chilliController.queryObj["userurl"]){o+="&userurl="+chilliController.queryObj["userurl"]}chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.logonStep3;chilliController.clientState=chilliController.AUTH_PENDING;chilliJSON.get(o)}else{if(!i||i==""){var u=new ChilliMD5;i=u.chap(chilliController.ident,r,t);log("chilliController.logonStep2: Calculating CHAP-Password = "+i)}chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.processReply;chilliController.clientState=chilliController.stateCodes.AUTH_PENDING;var a=chilliController.urlRoot()+"logon?username="+escape(n)+"&response="+i;if(chilliController.queryObj&&chilliController.queryObj["userurl"]){a+="&userurl="+chilliController.queryObj["userurl"]}chilliJSON.get(a)}};chilliController.logonStep3=function(e){log("Entering logonStep 3");var t=chilliController.temp.username;if(typeof e.response=="string"){chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.processReply;chilliController.clientState=chilliController.stateCodes.AUTH_PENDING;var n=chilliController.urlRoot()+"logon?username="+escape(t)+"&response="+e.response;if(chilliController.queryObj&&chilliController.queryObj["userurl"]){n+="&userurl="+chilliController.queryObj["userurl"]}chilliJSON.get(n)}};chilliController.refresh=function(){if(chilliController.autorefreshTimer){chilliController.command="autorefresh"}else{chilliController.command="refresh"}chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.processReply;chilliJSON.get(chilliController.urlRoot()+"status")};chilliController.logoff=function(){chilliController.command="logoff";chilliJSON.onError=chilliController.onError;chilliJSON.onJSONReady=chilliController.processReply;chilliJSON.get(chilliController.urlRoot()+"logoff")};chilliController.processReply=function(e){if(typeof e.message=="string"){var t=document.createElement("div");t.innerHTML=e.message;chilliController.message=t.innerHTML}if(typeof e.challenge=="string"){chilliController.challenge=e.challenge}if(typeof e.location=="object"){chilliController.location=e.location}if(typeof e.accounting=="object"){chilliController.accounting=e.accounting}if(typeof e.redir=="object"){chilliController.redir=e.redir}if(typeof e.session=="object"&&(chilliController.session==null||chilliController.clientState!==chilliController.stateCodes.AUTH&&e.clientState===chilliController.stateCodes.AUTH)){chilliController.session=e.session;if(e.session.startTime){chilliController.session.startTime=new Date;chilliController.session.startTime.setTime(e.session.startTime)}}if(e.clientState===chilliController.stateCodes.NOT_AUTH||e.clientState===chilliController.stateCodes.AUTH||e.clientState===chilliController.stateCodes.AUTH_SPLASH||e.clientState===chilliController.stateCodes.AUTH_PENDING){chilliController.clientState=e.clientState}else{chilliController.onError("Unknown clientState found in JSON reply")}if(chilliController.clientState===chilliController.stateCodes.AUTH){if(!chilliController.autorefreshTimer){chilliController.autorefreshTimer=setInterval("chilliController.refresh()",1e3*chilliController.interval)}}else if(chilliController.clientState===chilliController.stateCodes.NOT_AUTH){clearInterval(chilliController.autorefreshTimer);chilliController.autorefreshTimer=0}log("chilliController.processReply: Calling onUpdate. clienState = "+chilliController.clientState);chilliController.onUpdate(chilliController.command)};var chilliJSON={timeout:25e3,timer:0,node:0,timestamp:0};chilliJSON.expired=function(){if(chilliJSON.node.text){log("chilliJSON: reply content \n"+chilliJSON.node.text)}else{log("chilliJSON: request timed out (or reply is not valid JS)")}clearInterval(chilliJSON.timer);chilliJSON.timer=0;if(typeof chilliJSON.node!=="number"){document.getElementsByTagName("head")[0].removeChild(chilliJSON.node)}chilliJSON.node=0;chilliJSON.onError("JSON request timed out (or reply is not valid)")};chilliJSON.reply=function(e){clearInterval(chilliJSON.timer);chilliJSON.timer=0;var t=new Date;var n=t.getTime();if(chilliJSON.timestamp){log("chilliJSON: JSON reply received in "+(n-chilliJSON.timestamp)+" ms\n"+dumpObject(e))}if(typeof chilliJSON.node!=="number"){document.getElementsByTagName("head")[0].removeChild(chilliJSON.node)}chilliJSON.node=0;chilliJSON.onJSONReady(e)};chilliJSON.get=function(e){if(typeof e=="string"){chilliJSON.url=e}else{log("chilliJSON:error:Incorrect url passed to chilliJSON.get():"+e);chilliJSON.onError("Incorrect url passed to chilliJSON.get() ");return}if(chilliJSON.timer){log("logon:   There is already a request running. Return without launching a new request.");return}var t=document.createElement("script");t.type="text/javascript";var n;if(this.url.indexOf("?")===-1){n="?"}else{n="&"}t.src=chilliJSON.url+n+"callback=chilliJSON.reply";t.src+="&"+Math.random();chilliJSON.node=document.getElementsByTagName("head")[0].appendChild(t);chilliJSON.timer=setInterval("chilliJSON.expired()",chilliJSON.timeout);var r=new Date;chilliJSON.timestamp=r.getTime();log("chilliJSON: getting "+chilliJSON.url+" . Waiting for reply ...")};var chilliClock={isStarted:0};chilliClock.onTick=function(){log("You should define your own onTick() handler on this clock object. Clock value = "+this.value)};chilliClock.increment=function(){chilliClock.value=chilliClock.value+1;chilliClock.onTick(chilliClock.value)};chilliClock.resync=function(e){clearInterval(chilliClock.isStarted);chilliClock.value=parseInt(e,10);chilliClock.isStarted=setInterval("chilliClock.increment()",1e3)};chilliClock.start=function(e){if(typeof e!=="Number"){chilliClock.resync(0)}else{chilliClock.resync(e)}};chilliClock.stop=function(){clearInterval(chilliClock.isStarted);chilliClock.isStarted=0}